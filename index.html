<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BIP QA - Falhas x Output</title>

    <link rel="stylesheet" href="styles.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
</head>
<body>

    <header>
        <h1>üîß BIP QA - Falhas x Output</h1>
        <p>Sistema de an√°lise com gr√°ficos interativos e filtros avan√ßados</p>
    </header>

    <main>
        <div id="message" class="message"></div>

        <!-- UPLOAD -->
        <section class="card upload-card">
            <div class="drop-zone" id="drop-zone">üìÅ Arraste os arquivos aqui</div>

            <div class="upload-buttons">
                <button id="btn-select-falhas" class="primary-btn">üìÑ Falhas</button>
                <button id="btn-select-output" class="primary-btn">üìä Output</button>
            </div>

            <input id="file-input-falhas" type="file" accept=".xlsx" />
            <input id="file-input-output" type="file" accept=".xlsx" />

            <div class="file-list">
                <p>üìÑ Falhas: <span id="falhas-name">Nenhum</span></p>
                <p>üìä Output: <span id="output-name">Nenhum</span></p>
            </div>

            <button id="process-btn" class="primary-btn" disabled>üöÄ Processar</button>
        </section>

        <!-- LOADING -->
        <section id="loading" class="card hidden">
            <div class="spinner"></div>
            <span>Processando arquivos...</span>
        </section>

        <!-- RESULTS -->
        <section id="results" class="hidden">
            <button id="toggle-filtros" class="toggle-btn" style="margin-bottom: 16px;">üìä Mostrar Filtros</button>
            <div class="layout">
                <!-- FILTROS -->
                <aside class="filters-sidebar card hidden" id="filters-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h2 style="margin: 0;">üîç Filtros</h2>
                        <button id="minimize-filters" class="secondary-btn" style="padding: 4px 8px; font-size: 11px;">‚Æú</button>
                    </div>
                    <button id="clear-filters-btn" class="secondary-btn" style="width: 100%; margin-bottom: 10px;">‚úñ Limpar Tudo</button>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-estacao')">
                            <span>üìç Esta√ß√£o</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-estacao', this.value)">
                        <div id="filter-estacao" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-linha')">
                            <span>üìã Linha</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-linha', this.value)">
                        <div id="filter-linha" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-wo')">
                            <span>üì¶ Work Order</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-wo', this.value)">
                        <div id="filter-wo" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-modelo')">
                            <span>üè≠ Modelo</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-modelo', this.value)">
                        <div id="filter-modelo" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-descricao')">
                            <span>üìù Descri√ß√£o</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-descricao', this.value)">
                        <div id="filter-descricao" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-item')">
                            <span>üîß Item (Componente)</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-item', this.value)">
                        <div id="filter-item" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-data')">
                            <span>üìÖ Data</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-data', this.value)">
                        <div id="filter-data" class="checkbox-list"></div>
                    </div>

                    <div class="filter-block">
                        <label class="filter-header" onclick="toggleFilter('filter-turno')">
                            <span>üïê Turno</span>
                            <span class="filter-toggle">‚ñº</span>
                        </label>
                        <input type="text" class="filter-search" placeholder="Buscar..." onkeyup="filtrarCheckboxes('filter-turno', this.value)">
                        <div id="filter-turno" class="checkbox-list"></div>
                    </div>
                </aside>

                <!-- CONTE√öDO -->
                <section class="main-content">
                    <!-- RESUMO + TABELA MODELO -->
                    <div class="cards-grid">
                        <section class="card">
                            <h2>üìã Resumo por Esta√ß√£o</h2>
                            <div class="table-wrapper">
                                <table id="resumo-table">
                                    <thead>
                                        <tr>
                                            <th>Esta√ß√£o</th>
                                            <th>Data</th>
                                            <th>Pass</th>
                                            <th>Fail</th>
                                            <th>Total</th>
                                            <th>Taxa %</th>
                                            <th>FPY %</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>

                        <section class="card">
                            <h2>üìä Modelos (Clique para filtrar)</h2>
                            <div class="table-wrapper">
                                <table id="pivot-modelo-table">
                                    <thead>
                                        <tr>
                                            <th>Modelo</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </section>
                    </div>

                    <!-- GR√ÅFICOS -->
                    <div class="charts-grid">
                        <section class="card">
                            <h2>üìä Pareto - Causas (com % Acumulado)</h2>
                            <div class="chart-container">
                                <canvas id="paretoCausaChart"></canvas>
                            </div>
                        </section>

                        <section class="card">
                            <h2>üìä Pareto - Itens (com % Acumulado)</h2>
                            <div class="chart-container">
                                <canvas id="paretoItemChart"></canvas>
                            </div>
                        </section>

                        <section class="card">
                            <h2>üìä Falhas por Esta√ß√£o (Clique para filtrar)</h2>
                            <div class="chart-container">
                                <canvas id="pieEstacaoChart"></canvas>
                            </div>
                        </section>

                        <section class="card">
                            <h2>üìä Distribui√ß√£o de Modelos (Clique para filtrar)</h2>
                            <div class="chart-container">
                                <canvas id="pieModeloChart"></canvas>
                            </div>
                        </section>
                    </div>

                    <!-- TABELA FALHAS PREVIEW -->
                    <section class="card">
                        <h2>üìÑ Falhas (Preview - 50 primeiras)</h2>
                        <div class="table-wrapper">
                            <table id="falhas-table">
                                <thead>
                                    <tr>
                                        <th>Serial</th>
                                        <th>Esta√ß√£o</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Causa</th>
                                        <th>Item</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </section>
                </section>
            </div>
        </section>
    </main>

    <script src="app.js"></script>
</body>
</html>